INSERT OVERWRITE TABLE selfserve_service_l1_fact
select  
max(tasklist_id) as tasklist_id,
max(facility_id_key) as  facility_id_key,
max(agent_id_key) as agent_id_key,
max(tasklist_created_date_key) as tasklist_created_date_key,
max(tasklist_created_time_key) as tasklist_created_time_key,
max(shipment_actioned_flag) as shipment_actioned_flag,
max(attempt_no) as attempt_no,
max(cancel_comment) as cancel_comment,
max(cancel_reason) as cancel_reason,
max(alternate_contact_number) as alternate_contact_number,
max(RESCHEDULE_shipment_status) as RESCHEDULE_shipment_status,
max(RESCHEDULE_updater) as RESCHEDULE_updater,
max(ACN_shipment_status) as ACN_shipment_status,
max(ACN_updater) as ACN_updater,
max(Cancel_shipment_status) as Cancel_shipment_status,
max(Cancel_updater) as Cancel_updater,
max(primary_contact_number) as primary_contact_number,
product_title,
merchant_brand_name,
vendor_tracking_id,
max(expected_delivery_date) as expected_delivery_date,
max(rescheduled_delivery_date) as rescheduled_delivery_date,
max(Cancellation_trigger_time) as cancellation_trigger_time,
max(Cancellation_landing_time) as cancellation_landing_time,
max(Cancellation_confirmation_time) as cancellation_confirmation_time,
max(ACN_trigger_time) as acn_trigger_time,
max(ACN_landing_time) as acn_trigger_time,
max(ACN_confirmation_time) as acn_confirmation_time,
max(RESCHEDULE_trigger_time) as reschedule_trigger_time,
max(RESCHEDULE_landing_time) as reschedule_landing_time,
max(RESCHEDULE_confirmation_time) as reschedule_confirmation_time
from
(select 
vendor_tracking_id,
tasklist_id,
request_type,
event_type,
if(facility_id_key !=0,facility_id_key,NULL) as facility_id_key,
if(agent_id_key !=0,agent_id_key,NULL) as agent_id_key,
tasklist_created_date_key,
tasklist_created_time_key,
shipment_actioned_flag,
attempt_no,
expected_delivery_date,
primary_contact_number,
update_date_time,
shipment_status,
updater,
product_title,
merchant_brand_name,
if(request_type="RESCHEDULE" and event_type="CONFIRMATION",rescheduled_delivery_date,NULL) as rescheduled_delivery_date,
if(request_type="CANCELLATION" and event_type="TRIGGER",update_date_time,NULL) as Cancellation_trigger_time,
if(request_type="CANCELLATION" and event_type="LANDING",update_date_time,NULL) as Cancellation_landing_time,
if(request_type="CANCELLATION" and event_type="CONFIRMATION",update_date_time,NULL) as Cancellation_confirmation_time,
if(request_type="ALTERNATE_CONTACT_NUMBER" and event_type="TRIGGER",update_date_time,NULL) as ACN_trigger_time,
if(request_type="ALTERNATE_CONTACT_NUMBER" and event_type="LANDING",update_date_time,NULL) as ACN_landing_time,
if(request_type="ALTERNATE_CONTACT_NUMBER" and event_type="CONFIRMATION",update_date_time,NULL) as ACN_confirmation_time,
if(request_type="RESCHEDULE" and event_type="TRIGGER",update_date_time,NULL) as RESCHEDULE_trigger_time,
if(request_type="RESCHEDULE" and event_type="LANDING",update_date_time,NULL) as RESCHEDULE_landing_time,
if(request_type="RESCHEDULE" and event_type="CONFIRMATION",update_date_time,NULL) as RESCHEDULE_confirmation_time,
if(request_type="CANCELLATION" and event_type="CONFIRMATION",cancel_comment,NULL) as cancel_comment,
if(request_type="CANCELLATION" and event_type="CONFIRMATION",cancel_reason,NULL) as cancel_reason,
if(request_type="ALTERNATE_CONTACT_NUMBER" and event_type="CONFIRMATION",alternate_contact_number,NULL) as alternate_contact_number,
if(request_type="RESCHEDULE" and event_type="CONFIRMATION",shipment_status,NULL) as RESCHEDULE_shipment_status,
if(request_type="RESCHEDULE" and event_type="CONFIRMATION",updater,NULL) as RESCHEDULE_updater,
if(request_type="ALTERNATE_CONTACT_NUMBER" and event_type="CONFIRMATION",shipment_status,NULL) as ACN_shipment_status,
if(request_type="ALTERNATE_CONTACT_NUMBER" and event_type="CONFIRMATION",updater,NULL) as ACN_updater,
if(request_type="CANCELLATION" and event_type="CONFIRMATION",shipment_status,NULL) as Cancel_shipment_status,
if(request_type="CANCELLATION" and event_type="CONFIRMATION",updater,NULL) as Cancel_updater
from bigfoot_external_neo.scp_ekl__selfserve_service_l0_fact) a
group by vendor_tracking_id,
product_title,
merchant_brand_name;